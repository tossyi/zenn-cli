---
title: "How to GraphQLã‚’è©¦ã™(Getting Startedã€Query)"
emoji: "ğŸ¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["GraphQL", "Ruby"]
published: true
---

# Getting Started

æœ€åˆã«ã€How to GraphQLã®Getting Startedã‚’è©¦ã—ã¾ã™ã€‚

https://www.howtographql.com/graphql-ruby/1-getting-started/

## ç’°å¢ƒ
Rubyã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€2.3.0ä»¥ä¸ŠãŒæ±‚ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚
æœ¬è¨˜äº‹ã§ã¯ã€3.2.2ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚

```bash
% ruby -v
ruby 3.2.2 (2023-03-30 revision e51014f9c0) [x86_64-darwin19]
```

## ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

bundler, railsãªã©ã‚’installã—ã€rails newã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œã‚Šã€ã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¾ã™ã€‚
```bash
% gem install bundler
...
1 gem installed

% gem install rails 
...
Installing ri documentation for rails-7.2.1
...

% rails new graphql-tutorial --skip-action-mailer --skip-action-mailbox --skip-action-text --skip-active-storage --skip-action-cable --skip-javascript --skip-system-test --skip-webpack-install

% cd graphql-tutorial 
% bundle exec rails db:create
% bundle exec rails server

```

http://127.0.0.1:3000/ ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã€Ruby on Railsã®ãƒˆãƒƒãƒ—ç”»é¢ãŒèµ·å‹•ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

## ã‚µãƒ¼ãƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ç¶šã„ã¦ã€GraphQLã‚’ã‚µãƒ¼ãƒã«è¿½åŠ ã—ã¾ã™ã€‚
Gemfileã«'graphql'ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```Gemfile
gem 'graphql'
```

```bash
bundle install
bundle exec rails generate graphql:install

```

Gemfileã«graphiql-railsãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
ã‚‚ã—ã€å…¥ã£ã¦ã„ãªã‘ã‚Œã°ã€è¿½åŠ ã—ã¾ã™ã€‚
```Gemfile
gem "graphiql-rails", group: :development
```

# Query
ç¶šã„ã¦ã€GraphQLã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã—ã€Rubyã§ã‚¯ã‚¨ãƒªãƒªã‚¾ãƒ«ãƒã‚’å®Ÿè£…ã—ã€GraphiQL Playgroundã‚’ä½¿ç”¨ã—ã¦ã€ã‚¯ã‚¨ãƒªã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

https://www.howtographql.com/graphql-ruby/2-queries/

æœ€åˆã«Linkãƒ¢ãƒ‡ãƒ«ã‚’ä½œã‚Šã¾ã™ã€‚

```bash
% bundle exec rails g model Link url:string description:text
      invoke  active_record
      create    db/migrate/20240922095822_create_links.rb
      create    app/models/link.rb
      invoke    test_unit
      create      test/models/link_test.rb
      create      test/fixtures/links.yml
```

dbã‚’migrateã—ã¾ã™ã€‚
```bash
% bundle exec rails db:migrate
== 20240922095822 CreateLinks: migrating ======================================
-- create_table(:links)
   -> 0.0021s
== 20240922095822 CreateLinks: migrated (0.0021s) =============================
```

Linkãƒ¢ãƒ‡ãƒ«ãŒã§ãã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
% cat app/models/link.rb
class Link < ApplicationRecord
end
```

ç¶šã„ã¦ã€rails consoleã‚’å®Ÿè¡Œã—ã€ãƒ€ãƒŸãƒ¼ã®ãƒªãƒ³ã‚¯ã‚’ä½œæˆã—ã¾ã™ã€‚
```bash
% bundle exec rails c
Loading development environment (Rails 7.2.1)
graphql-tutorial(dev)> Link.create url: 'http://graphql.org/', desc
ription: 'The Best Query Language'
graphql-tutorial(dev)> Link.create url: 'http://dev.apollodata.com/
', description: 'Awesome GraphQL Client'
graphql-tutorial(dev)> exit
  TRANSACTION (0.0ms)  begin transaction
  Link Create (0.5ms)  INSERT INTO "links" ("url", "description", "created_at", "updated_at") VALUES ('http://graphql.org/', 'The Best Query Language', '2024-09-22 10:03:42.925831', '2024-09-22 10:03:42.925831') RETURNING "id" /*application='GraphqlTutorial'*/
  TRANSACTION (0.5ms)  commit transaction
  TRANSACTION (0.0ms)  begin transaction
  Link Create (0.2ms)  INSERT INTO "links" ("url", "description", "created_at", "updated_at") VALUES ('http://dev.apollodata.com/', 'Awesome GraphQL Client', '2024-09-22 10:03:42.927963', '2024-09-22 10:03:42.927963') RETURNING "id" /*application='GraphqlTutorial'*/
  TRANSACTION (0.1ms)  commit transaction
```

## è¿”é€ã™ã‚‹ãŸã‚ã®ã‚¯ã‚¨ãƒª

graphqlã®LinkTypeã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚Šã¾ã™ã€‚

```bash
% rails g graphql:object LinkType id:ID! url:String! description:String!
      create  app/graphql/types/link_type.rb
```

`link_type.rb`ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
% cat app/graphql/types/link_type.rb

# frozen_string_literal: true

module Types
  class LinkType < Types::BaseObject
    field :id, ID, null: false
    field :url, String, null: false
    field :description, String, null: false
  end
end
```

## Query Resolver

ã“ã“ã¾ã§ã§graphqlã‚¿ã‚¤ãƒ—ã¯å®šç¾©ã•ã‚Œã¾ã—ãŸãŒã€GraphQLã‚µãƒ¼ãƒãŒç‰¹å®šã®ã‚¯ã‚¨ãƒªã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ãƒªã‚¾ãƒ«ãƒãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
GraphQLã‚¿ã‚¤ãƒ—ã®å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã€å¯¾å¿œã™ã‚‹ãƒªã‚¾ãƒ«ãƒé–¢æ•°ãŒå¿…è¦ã§ã™ã€‚

`bundle exec rails generate graphql:install`ã®ã¨ãã«ã€`app/graphql/types/query_type.rb`ã¯ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

`app/graphql/types/query_type.rb`ã¯ã€ä»¥ä¸‹ã«å¤‰æ›´ã—ã¾ã™ã€‚
```bash
module Types
  class QueryType < BaseObject
    # queries are just represented as fields
    # `all_links` is automatically camelcased to `allLinks`
    field :all_links, [LinkType], null: false

    # this method is invoked, when `all_link` fields is being resolved
    def all_links
      Link.all
    end
  end
end

```

`field`ã¯ã„ãšã‚Œã‹ã®2ã¤ã®æ–¹æ³•ã®ã„ãšã‚Œã‹ã‚’æŒ‡å®šã§ãã¾ã™ã€‚
* `field`ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯argumentsã‚’å—ã‘å…¥ã‚Œã‚‹ã“ã¨ã€ãŠã‚ˆã³ã€objectã‚„contextã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
* `GraphQL::Schema::Resolver`

## Playgroundã§ãƒ†ã‚¹ãƒˆã™ã‚‹
GraphiQLã§GraphQLã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

assetsã«pre conpileã™ã‚‹ã‚ˆã†ã«`app/assets/config/manifest.js`ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚
```
//= link graphiql/rails/application.css
//= link graphiql/rails/application.js
```

railsã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¦ãŠãã¾ã™ã€‚
```bash
% bundle exec rails s 
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://127.0.0.1:3000/graphiql ã‚’é–‹ãã¾ã™ã€‚

`query_type.rb`ã®fieldã€all_linksã¯Link.allã‚’è¿”ã—ã€è¿”ã‚Šå€¤ã¨ã—ã¦[LinkType]ã®é…åˆ—ã‚’è¿”ã™ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
`LinkType`ã¯ã€`link_type.rb`ã®å„fieldã§ã‚ã‚‹idã€urlã€descriptionã‚’è¿”ã—ã¾ã™ã€‚

![](/images/graphiql-top.png)
