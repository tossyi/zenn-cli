---
title: "How to GraphQLã‚’è©¦ã™(Mutation)"
emoji: "ğŸ’¬"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["GraphQL", "Ruby"]
published: true
---

# å‰è¨˜äº‹
ã“ã®è¨˜äº‹ã¯ã€ä»¥ä¸‹ã®ç¶šãã§ã™ã€‚
https://zenn.dev/tossy21/articles/b954107df8d544

# Mutation

mutationã§ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã€å¤‰æ›´ã€å‰Šé™¤ã‚’è¡Œã„ã¾ã™ã€‚

`app/graphql/types/mutation_type.rb`ã¯è‡ªå‹•ã§ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

```ruby
module Types
  class MutationType < Types::BaseObject
    # TODO: remove me
    field :test_field, String, null: false,
      description: "An example field added by the generator"
    def test_field
      "Hello World"
    end
  end
end
```

ã¾ãŸã€`graphql_tutorial_schema.rb`ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```ruby
class GraphqlTutorialSchema < GraphQL::Schema
  mutation(Types::MutationType)
  query(Types::QueryType)
end
```

## å¼•æ•°ä»˜ããƒªã‚¾ãƒ«ãƒ

æ¬¡ã«ã€`createLink`ã®ãƒªã‚¾ãƒ«ãƒã‚’è¿½åŠ ã—ã¾ã™ã€‚
`app/graphql/mutations/base_mutation.rb`ã¯ä»¥ä¸‹ã¨ãªã£ã¦ã„ã¾ã™ã€‚

```ruby
module Mutations
  class BaseMutation < GraphQL::Schema::RelayClassicMutation
    argument_class Types::BaseArgument
    field_class Types::BaseField
    input_object_class Types::BaseInputObject
    object_class Types::BaseObject
  end
end
```

`app/graphql/mutations/create_link.rb`ã‚’ä½œæˆã—ã¾ã™ã€‚
```bash
% touch app/graphql/mutations/create_link.rb
```

```ruby
module Mutations
  class CreateLink < BaseMutation
    # arguments passed to the `resolve` method
    argument :description, String, required: true
    argument :url, String, required: true

    # return type from the mutation
    type Types::LinkType

    def resolve(description: nil, url: nil)
      Link.create!(
        description: description,
        url: url,
      )
    end
  end
end
```

`app/graphql/types/mutation_type.rb`ã‚’æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚
```ruby
module Types
  class MutationType < Types::BaseObject
    field :create_link, mutation: Mutations::CreateLink
  end
end
```

## Playgroundã§ãƒ†ã‚¹ãƒˆ

mutationã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä½œæˆã—ã¾ã—ãŸã€‚
```
mutation{
  createLink(
    input: {
    url: "http://npmjs.com/package/graphql-tools",
    description: "Best tools!",
    }
  ){
    id
    url
    description
  }
}
```

å¿œç­”ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¿”ã£ã¦ãã¾ã—ãŸã€‚

```
{
  "data": {
    "createLink": {
      "id": "3",
      "url": "http://npmjs.com/package/graphql-tools",
      "description": "Best tools!"
    }
  }
}
```

https://zenn.dev/tossy21/articles/d0bb29cb0fcd2b
