---
title: "Python Slack SDKã®chat.postMessageã‚’ä½¿ã£ã¦ï¼ŒSlackã®ãƒãƒ£ãƒ³ãƒãƒ«ã¸é€šçŸ¥ã™ã‚‹"
emoji: "ğŸ‘»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Python, Slack, Tech]
published: true
---

Python Slack SDKã®chat.postMessageã‚’ä½¿ã£ã¦ï¼ŒSlackã®ãƒãƒ£ãƒ³ãƒãƒ«ã¸é€šçŸ¥ã—ã¾ã™ã€‚

# Slack Appã®ä½œæˆ
- https://api.slack.com/apps ã¸ã‚¢ã‚¯ã‚»ã‚¹
- Create New Appã‚’æŠ¼ä¸‹
- Create an appã§ã€Œfrom scratchã€ã‚’é¸æŠ
- App Name ã¨ workspace ã‚’é¸æŠã—ï¼ŒCreate Appã‚’æŠ¼ä¸‹

- Featuresã®ã€ŒOAuth & Permissionsã€ã‚’æŠ¼ä¸‹
- Scopesã®ã€ŒBot Token Scopesã€ã§ã€ŒAdd an OAuth Scopeã€ã‚’æŠ¼ä¸‹
- ã€Œchat:writeã€ã‚’é¸æŠ
- ä¸Šã®æ–¹ã«ã‚ã‚‹ï¼Œã€ŒOAuth Tokens for Your Workspaceã€>ã€ŒInstall to Workspaceã€ã‚’æŠ¼ä¸‹
- ã€ŒApp Name is requesting permission to access the myworkspace Slack workspace What will MySlackApp be able to do?ã€ã®ç”»é¢ãŒå‡ºã‚‹ã®ã§ï¼Œã€ŒAllowã€ã‚’æŠ¼ä¸‹
- OAuth Tokens for Your Workspace>Bot User OAuth Token ã«OAuth Access TokenãŒå‡ºã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™
- ã“ã®OAuth Access Tokenã‚’Python Slack SDKã®WebClientã§ä½¿ç”¨ã—ã¾ã™ã€‚

# chat.postMessageã‹ã‚‰Slackã¸ã®é€šçŸ¥

Python Slack SDKã‚’ç”¨ã„ã¦ï¼ŒSlackã®ãƒãƒ£ãƒ³ãƒãƒ«ã¸é€šçŸ¥ã™ã‚‹ã€‚

Pythonã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®å…¬å¼ã‚µãƒ³ãƒ—ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
https://api.slack.com/methods/chat.postMessage/code

- "SLACK_BOT_TOKEN"ã¯ï¼ŒOAuth Access Tokenã‚’å…¥ã‚Œã¾ã™
  - export SLACK_BOT_TOKEN=`SLACK_BOT_TOKEN` ã§èª­ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«ã—ã¾ã™
- channel_idã¯ï¼Œé€šçŸ¥ã—ãŸã„Slackã®ãƒãƒ£ãƒ³ãƒãƒ«ã®Channel IDã‚’å…¥ã‚Œã¾ã™
  - Channel IDã¯ï¼Œãƒãƒ£ãƒ³ãƒãƒ«ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ï¼ŒView channel detailsã‚’æŠ¼ä¸‹ã™ã‚‹ã¨ï¼ŒAboutã®ä¸€ç•ªä¸‹ã«ã‚ã‚Šã¾ã™

```python
import logging
import os
# Import WebClient from Python SDK (github.com/slackapi/python-slack-sdk)
from slack_sdk import WebClient
from slack_sdk.errors import SlackApiError

# WebClient instantiates a client that can call API methods
# When using Bolt, you can use either `app.client` or the `client` passed to listeners.
client = WebClient(token=os.environ.get("SLACK_BOT_TOKEN"))
logger = logging.getLogger(__name__)

# ID of the channel you want to send the message to
channel_id = "C12345"

try:
    # Call the chat.postMessage method using the WebClient
    result = client.chat_postMessage(
        channel=channel_id, 
        text="Hello world"
    )
    logger.info(result)

except SlackApiError as e:
    logger.error(f"Error posting message: {e}")

```

Pythonã®ä»®æƒ³ç’°å¢ƒã‚’ç”¨æ„ã—ã¦ï¼Œslack-sdkã‚’pipã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
ä»Šå›ã¯venvã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚

```bash
python -m venv .venv
source .venv/bin/activate

pip install slack-sdk
```

ã•ãã»ã©ã®Pythonã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
python test.py
```

ã™ã‚‹ã¨ï¼Œä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸã€‚

```bash
Error posting message: The request to the Slack API failed. (url: https://www.slack.com/api/chat.postMessage)
The server responded with: {'ok': False, 'error': 'not_in_channel'}
```

ã“ã‚Œã«ã¤ã„ã¦ã¯ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ãƒœãƒƒãƒˆãŒå¯¾è±¡ã®ãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒ¡ãƒ³ãƒãƒ¼ã§ãªã„ã“ã¨ã‹ã‚‰ç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ï¼Œè©²å½“ã®ãƒãƒ£ãƒ³ãƒãƒ«ã«ä½œæˆã—ãŸAppã‚’æ‹›å¾…ã™ã‚Œã°è§£æ±ºã§ãã¾ã™ã€‚

